<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
.tile{
	width: 20px;
	height: 20px;
}

</style>
<script type="text/javascript">
class Block{
	constructor(){
		this.type =7;
		this.status = 0;
		this.i = 2;
		this.j = 5;
	}
}
var b = new Block();

var block2D= [
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0]
];

var stack2D= [
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[1,1,1,1,1,	1,0,0,0,0],
	[1,1,1,1,1,	1,1,1,0,0]
];


var displ2D= [
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0],
	[0,0,0,0,0,	0,0,0,0,0]
];

function setBlock2D(){
	
	for(var i=0;i<25;i++){
		for(var j=0;j<10;j++){
			block2D[i][j]=0;
		}
	}
	
	if(b.type==1){
		block2D[b.i]	[b.j]	= b.type;
		block2D[b.i]	[b.j+1]	= b.type;
		block2D[b.i+1]	[b.j]	= b.type;
		block2D[b.i+1]	[b.j+1]	= b.type;		
	}
	if(b.type==2){
		if(b.status==0){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i-2]	[b.j]	= b.type;
			block2D[b.i+1]	[b.j]	= b.type;			
		}else if(b.status==1){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i]	[b.j-1]	= b.type;
			block2D[b.i]	[b.j-2]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;
		}
	}
	if(b.type==3){
		if(b.status==0){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;
			block2D[b.i-1]	[b.j+1]	= b.type;
			block2D[b.i+1]	[b.j]	= b.type;
		
		}else if(b.status==1){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j-1]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;

		}
	}
	
	if(b.type==4){
		if(b.status==0){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;
			block2D[b.i+1]	[b.j+1]	= b.type;

		}else if(b.status==1){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i]	[b.j-1]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j+1]	= b.type;
		}
	}	
	
	if(b.type==5){
		if(b.status==0){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i]	[b.j-1]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;
			block2D[b.i-1]	[b.j+1]	= b.type;
		}else if(b.status==1){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i+1]	[b.j]	= b.type;
			block2D[b.i+1]	[b.j+1]	= b.type;
		}else if(b.status==2){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i]	[b.j-1]	= b.type;
			block2D[b.i+1]	[b.j-1]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;
		}else if(b.status==3){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j-1]	= b.type;
			block2D[b.i+1]	[b.j]	= b.type;
		}
	}	
	
	if(b.type==6){
		if(b.status==0){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i]	[b.j-1]	= b.type;
			block2D[b.i-1]	[b.j-1]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;

		}else if(b.status==1){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j+1]	= b.type;
			block2D[b.i+1]	[b.j]	= b.type;

		}else if(b.status==2){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i]	[b.j-1]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;
			block2D[b.i+1]	[b.j+1]	= b.type;

		}else if(b.status==3){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i+1]	[b.j]	= b.type;
			block2D[b.i+1]	[b.j-1]	= b.type;

		}
	}
	
	if(b.type==7){
		if(b.status==0){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i]	[b.j-1]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;
			
		}else if(b.status==1){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i+1]	[b.j]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;
		}else if(b.status==2){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i]	[b.j-1]	= b.type;
			block2D[b.i]	[b.j+1]	= b.type;
			block2D[b.i+1]	[b.j]	= b.type;
		}else if(b.status==3){
			block2D[b.i]	[b.j]	= b.type;
			block2D[b.i-1]	[b.j]	= b.type;
			block2D[b.i]	[b.j-1]	= b.type;
			block2D[b.i+1]	[b.j]	= b.type;
		}
	}
}

function my_render(){
	var tiles = document.querySelectorAll(".tile");
	
	for(var i=0;i<25;i++){
		for(var j=0;j<10;j++){
			if(displ2D[i][j]==0){
				tiles[i*10+j].bgColor = "white";
			}
			if(displ2D[i][j]==1){
				tiles[i*10+j].bgColor = "gray";
			}
			if(displ2D[i][j]==2){
				tiles[i*10+j].bgColor = "green";
			}
			if(displ2D[i][j]==3){
				tiles[i*10+j].bgColor = "cyan";
			}
			if(displ2D[i][j]==4){
				tiles[i*10+j].bgColor = "orange";
			}
			if(displ2D[i][j]==5){
				tiles[i*10+j].bgColor = "rgb(204, 102, 204)";
			}
			if(displ2D[i][j]==6){
				tiles[i*10+j].bgColor = "gold";
			}
			if(displ2D[i][j]==7){
				tiles[i*10+j].bgColor = "tomato";
			}
			
			if(displ2D[i][j]==8){
				tiles[i*10+j].bgColor = "rgb(051, 051, 051)";
			}
			if(displ2D[i][j]==9){
				tiles[i*10+j].bgColor = "rgb(051, 051, 051)";
			}
			if(displ2D[i][j]==10){
				tiles[i*10+j].bgColor = "rgb(051, 153, 153)";
			}
			if(displ2D[i][j]==11){
				tiles[i*10+j].bgColor = "rgb(200, 98, 000)";
			}
			if(displ2D[i][j]==12){
				tiles[i*10+j].bgColor = "rgb(102, 000, 102)";
			}
			if(displ2D[i][j]==13){
				tiles[i*10+j].bgColor = "rgb(153, 102, 000)";
			}
			if(displ2D[i][j]==14){
				tiles[i*10+j].bgColor = "rgb(204, 000, 102)";
			}
		}
	}
	
}
function rotate(){
	if(b.type==1){
		
	} else if(b.type==2||b.type==3||b.type==4){
		if(b.status==0){
			b.status=1;
		}else if(b.status==1){
			b.status=0;
		}
	} else if(b.type==5||b.type==6||b.type==7){
		if(b.status==0){
			b.status=1;
		}else if(b.status==1){
			b.status=2;
		}else if(b.status==2){
			b.status=3;
		}else if(b.status==3){
			b.status=0;
		}
	}
}

function setDispl2D(){
	for(var i=0;i<25;i++){
		for(var j=0;j<10;j++){
			displ2D[i][j]=0;				
		}
	}
	
	for(var i=0;i<25;i++){
		for(var j=0;j<10;j++){
			if(block2D[i][j]>0){
				displ2D[i][j]=block2D[i][j];
			}		
		}
	}
	for(var i=0;i<25;i++){
		for(var j=0;j<10;j++){
			if(stack2D[i][j]>0){
				displ2D[i][j]=stack2D[i][j];
			}		
		}
	}

}

function isBlockStack(){
	for(var i=0; i<25; i++){
		for(var j=0; j<10; j++){
			if(stack2D[i][j] > 0 && block2D[i][j]){
				return true;
			}
		}
	}
	return false;
}

function isBlockSide(){
	var cnt = 0;
	for(var i=0; i<25; i++){
		for(var j=0; j<10; j++){
			if(block2D[i][j] > 0){
				cnt ++;
			}
		}
	}
	if(cnt ==4){
		return false;
	}else{
		return true;
	}
}

function moveBlock2DToStack2D(){
	var cnt = 0;
	for(var i=0; i<25; i++){
		for(var j=0; j<10; j++){
			if(block2D[i][j] > 0){
				stack2D[i][j] = block2D[i][j];
			}
		}
	}
}

function myclick(e){
	var back_status = b.status;
	var back_i = b.i;
	var back_j = b.j;
	var flagDown = false;
	
	var code = e.code;
	if(code=="ArrowUp"){b.i--;}
	if(code=="ArrowDown"){
		b.i++; 
		flagDown = true;
	}
	if(code=="ArrowLeft"){b.j--;}
	if(code=="ArrowRight"){b.j++;}
	if(code=="Space"){rotate();}
	
	var flagBlockErr = false;
	try{
		setBlock2D();
		setDispl2D();
	}catch(error){ flagBlockErr = true; }
	var flagBlockStack =isBlockStack();
	var flagBlockSide = isBlockSide();
	var flagCrush = flagBlockStack || flagBlockSide || flagBlockErr;
	
	if(flagCrush == true){
		b.status = back_status;
		b.i = back_i;
		b.j = back_j;
		setBlock2D();
		setDispl2D();
	}
	if(flagCrush && flagDown){
		moveBlock2DToStack2D();
		console.log(stack2D);
		b.type =  parseInt(Math.random() * 7)+1;
		
		b.i = 1;
		b.j = 5;
		setBlock2D();
		setDispl2D();
	}
	my_render();
}

window.addEventListener("keydown", (e) => 
	myclick(e)
);

</script>

</head>
<body>
TETRIS <a href="javascript:setBlock2D()">call</a> <a href="javascript:my_render()">render</a>
<table border="1">
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>	

	
	
	
</table>

</body>
</html>